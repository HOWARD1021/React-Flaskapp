import Result, { Message, ResultOptions } from './result.js'
import { SourceMap } from './postcss.js'
import Processor from './processor.js'
import Warning from './warning.js'
import Root from './root.js'

/**
 * A Promise proxy for the result of PostCSS transformations.
 *
 * A `LazyResult` instance is returned by `Processor#process`.
 *
 * ```js
 * const lazy = postcss([autoprefixer]).process(css)
 * ```
 */
export default class LazyResult implements PromiseLike<Result> {
  /**
   * Processes input CSS through synchronous and asynchronous plugins
   * and calls `onFulfilled` with a Result instance. If a plugin throws
   * an error, the `onRejected` callback will be executed.
   *
   * It implements standard Promise API.
   *
   * ```js
   * postcss([autoprefixer]).process(css, { from: cssPath }).then(result => {
   *   console.log(result.css)
   * })
   * ```
   */
  then: Promise<Result>['then']

  /**
   * Processes input CSS through synchronous and asynchronous plugins
   * and calls onRejected for each error thrown in any plugin.
   *
   * It implements standard Promise API.
   *
   * ```js
   * postcss([autoprefixer]).process(css).then(result => {
   *   console.log(result.css)
   * }).catch(error => {
   *   console.error(error)
   * })
   * ```
   */
  catch: Promise<Result>['catch']

  /**
   * Processes input CSS through synchronous and asynchronous plugins
   * and calls onFinally on any error or when all plugins will finish work.
   *
   * It implements standard Promise API.
   *
   * ```js
   * postcss([autoprefixer]).process(css).finally(() => {
   *   console.log('processing ended')
   * })
   * ```
   */
  finally: Promise<Result>['finally']

  /**
   * @param processor Processor used for this transformation.
   * @param css       CSS to parse and transform.
   * @param opts      Options from the `Processor#process` or `Root#toResult`.
   */
<<<<<<< Updated upstream
  constructor (processor: Processor, css: string, opts: ResultOptions)
=======
  constructor(processor: Processor, css: string, opts: ResultOptions)
>>>>>>> Stashed changes

  /**
   * Returns the default string description of an object.
   * Required to implement the Promise interface.
   */
<<<<<<< Updated upstream
  get [Symbol.toStringTag] (): string
=======
  get [Symbol.toStringTag](): string
>>>>>>> Stashed changes

  /**
   * Returns a `Processor` instance, which will be used
   * for CSS transformations.
   */
<<<<<<< Updated upstream
  get processor (): Processor
=======
  get processor(): Processor
>>>>>>> Stashed changes

  /**
   * Options from the `Processor#process` call.
   */
<<<<<<< Updated upstream
  get opts (): ResultOptions
=======
  get opts(): ResultOptions
>>>>>>> Stashed changes

  /**
   * Processes input CSS through synchronous plugins, converts `Root`
   * to a CSS string and returns `Result#css`.
   *
   * This property will only work with synchronous plugins.
   * If the processor contains any asynchronous plugins
   * it will throw an error. This is why this method is only
   * for debug purpose, you should always use `LazyResult#then`.
   */
<<<<<<< Updated upstream
  get css (): string
=======
  get css(): string
>>>>>>> Stashed changes

  /**
   * An alias for the `css` property. Use it with syntaxes
   * that generate non-CSS output.
   *
   * This property will only work with synchronous plugins.
   * If the processor contains any asynchronous plugins
   * it will throw an error. This is why this method is only
   * for debug purpose, you should always use `LazyResult#then`.
   */
<<<<<<< Updated upstream
  get content (): string
=======
  get content(): string
>>>>>>> Stashed changes

  /**
   * Processes input CSS through synchronous plugins
   * and returns `Result#map`.
   *
   * This property will only work with synchronous plugins.
   * If the processor contains any asynchronous plugins
   * it will throw an error. This is why this method is only
   * for debug purpose, you should always use `LazyResult#then`.
   */
<<<<<<< Updated upstream
  get map (): SourceMap
=======
  get map(): SourceMap
>>>>>>> Stashed changes

  /**
   * Processes input CSS through synchronous plugins
   * and returns `Result#root`.
   *
   * This property will only work with synchronous plugins. If the processor
   * contains any asynchronous plugins it will throw an error.
   *
   * This is why this method is only for debug purpose,
   * you should always use `LazyResult#then`.
   */
<<<<<<< Updated upstream
  get root (): Root
=======
  get root(): Root
>>>>>>> Stashed changes

  /**
   * Processes input CSS through synchronous plugins
   * and returns `Result#messages`.
   *
   * This property will only work with synchronous plugins. If the processor
   * contains any asynchronous plugins it will throw an error.
   *
   * This is why this method is only for debug purpose,
   * you should always use `LazyResult#then`.
   */
<<<<<<< Updated upstream
  get messages (): Message[]
=======
  get messages(): Message[]
>>>>>>> Stashed changes

  /**
   * Processes input CSS through synchronous plugins
   * and calls `Result#warnings`.
   *
   * @return Warnings from plugins.
   */
<<<<<<< Updated upstream
  warnings (): Warning[]
=======
  warnings(): Warning[]
>>>>>>> Stashed changes

  /**
   * Alias for the `LazyResult#css` property.
   *
   * ```js
   * lazy + '' === lazy.css
   * ```
   *
   * @return Output CSS.
   */
<<<<<<< Updated upstream
  toString (): string
=======
  toString(): string
>>>>>>> Stashed changes

  /**
   * Run plugin in sync way and return `Result`.
   *
   * @return Result with output content.
   */
<<<<<<< Updated upstream
  sync (): Result
=======
  sync(): Result
>>>>>>> Stashed changes

  /**
   * Run plugin in async way and return `Result`.
   *
   * @return Result with output content.
   */
<<<<<<< Updated upstream
  async (): Promise<Result>
=======
  async(): Promise<Result>
>>>>>>> Stashed changes
}
